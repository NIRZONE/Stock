<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const InventoryApp = () => {
            // Authentication state
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState([]);

            const [activeTab, setActiveTab] = useState('dashboard');
            const [employees, setEmployees] = useState([]);
            const [categories, setCategories] = useState(['SIM', 'Hardware', 'Accessories']);
            const [companyStock, setCompanyStock] = useState([]);
            const [allocations, setAllocations] = useState([]);
            const [transactions, setTransactions] = useState([]);
            const [autoBackupEnabled, setAutoBackupEnabled] = useState(false);

            const [githubConfig, setGithubConfig] = useState({
                token: '',
                username: '',
                repo: '',
                configured: false
            });

            useEffect(() => {
                loadUsers();
                checkLoginStatus();
            }, []);

            useEffect(() => {
                if (isLoggedIn) {
                    loadFromLocalStorage();
                    loadGitHubConfig();
                }
            }, [isLoggedIn]);

            const loadUsers = () => {
                const savedUsers = localStorage.getItem('inventoryUsers');
                if (savedUsers) {
                    setUsers(JSON.parse(savedUsers));
                } else {
                    // Create default admin account
                    const defaultAdmin = {
                        id: 'USER' + Date.now(),
                        username: 'admin',
                        password: 'admin123',
                        role: 'admin',
                        createdAt: new Date().toISOString()
                    };
                    setUsers([defaultAdmin]);
                    localStorage.setItem('inventoryUsers', JSON.stringify([defaultAdmin]));
                }
            };

            const checkLoginStatus = () => {
                const savedSession = localStorage.getItem('inventorySession');
                if (savedSession) {
                    const session = JSON.parse(savedSession);
                    const savedUsers = JSON.parse(localStorage.getItem('inventoryUsers'));
                    const user = savedUsers.find(u => u.id === session.userId);
                    if (user) {
                        setCurrentUser(user);
                        setIsLoggedIn(true);
                    }
                }
            };

            const handleLogin = (username, password) => {
                const user = users.find(u => u.username === username && u.password === password);
                if (user) {
                    setCurrentUser(user);
                    setIsLoggedIn(true);
                    localStorage.setItem('inventorySession', JSON.stringify({ userId: user.id }));
                    return true;
                }
                return false;
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setCurrentUser(null);
                localStorage.removeItem('inventorySession');
                setActiveTab('dashboard');
            };

            const isAdmin = () => currentUser && currentUser.role === 'admin';

            const loadFromLocalStorage = () => {
                const saved = localStorage.getItem('inventoryData');
                if (saved) {
                    const data = JSON.parse(saved);
                    setEmployees(data.employees || []);
                    setCategories(data.categories || ['SIM', 'Hardware', 'Accessories']);
                    setCompanyStock(data.companyStock || []);
                    setAllocations(data.allocations || []);
                    setTransactions(data.transactions || []);
                }
            };

            const loadGitHubConfig = () => {
                const saved = localStorage.getItem('githubConfig');
                if (saved) {
                    const config = JSON.parse(saved);
                    setGithubConfig(config);
                    setAutoBackupEnabled(config.autoBackup || false);
                }
            };

            useEffect(() => {
                if (isLoggedIn) {
                    const data = { employees, categories, companyStock, allocations, transactions };
                    localStorage.setItem('inventoryData', JSON.stringify(data));
                    
                    if (autoBackupEnabled && githubConfig.configured && isAdmin()) {
                        autoBackupToGitHub(data);
                    }
                }
            }, [employees, categories, companyStock, allocations, transactions, autoBackupEnabled, githubConfig]);

            const autoBackupToGitHub = async (data) => {
                try {
                    await saveToGitHub(data, true);
                } catch (error) {
                    console.error('Auto backup failed:', error);
                }
            };

            const saveToGitHub = async (data, isAuto = false) => {
                if (!githubConfig.configured) {
                    alert('Please configure GitHub settings first!');
                    return;
                }

                const backupData = {
                    ...data,
                    backupDate: new Date().toISOString(),
                    version: '1.0'
                };

                const content = btoa(JSON.stringify(backupData, null, 2));
                const fileName = 'inventory-backup.json';
                const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${fileName}`;

                try {
                    let sha = null;
                    try {
                        const checkResponse = await fetch(url, {
                            headers: {
                                'Authorization': `token ${githubConfig.token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        if (checkResponse.ok) {
                            const fileData = await checkResponse.json();
                            sha = fileData.sha;
                        }
                    } catch (e) {}

                    const response = await fetch(url, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: isAuto ? `Auto backup - ${new Date().toLocaleString()}` : `Manual backup - ${new Date().toLocaleString()}`,
                            content: content,
                            ...(sha && { sha: sha })
                        })
                    });

                    if (response.ok) {
                        if (!isAuto) {
                            alert('‚úÖ Backup saved to GitHub successfully!');
                        }
                    } else {
                        const error = await response.json();
                        throw new Error(error.message);
                    }
                } catch (error) {
                    if (!isAuto) {
                        alert('‚ùå Backup failed: ' + error.message);
                    }
                    console.error('GitHub backup error:', error);
                }
            };

            const restoreFromGitHub = async () => {
                if (!githubConfig.configured) {
                    alert('Please configure GitHub settings first!');
                    return;
                }

                const fileName = 'inventory-backup.json';
                const url = `https://api.github.com/repos/${githubConfig.username}/${githubConfig.repo}/contents/${fileName}`;

                try {
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });

                    if (response.ok) {
                        const fileData = await response.json();
                        const content = atob(fileData.content);
                        const backupData = JSON.parse(content);

                        if (confirm(`Restore backup from ${new Date(backupData.backupDate).toLocaleString()}?\n\nThis will replace all current data!`)) {
                            setEmployees(backupData.employees || []);
                            setCategories(backupData.categories || ['SIM', 'Hardware', 'Accessories']);
                            setCompanyStock(backupData.companyStock || []);
                            setAllocations(backupData.allocations || []);
                            setTransactions(backupData.transactions || []);
                            alert('‚úÖ Data restored successfully from GitHub!');
                        }
                    } else {
                        alert('‚ùå No backup found on GitHub!');
                    }
                } catch (error) {
                    alert('‚ùå Restore failed: ' + error.message);
                    console.error('GitHub restore error:', error);
                }
            };

            const downloadBackup = () => {
                const data = { employees, categories, companyStock, allocations, transactions, backupDate: new Date().toISOString() };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `inventory-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const uploadBackup = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (confirm(`Restore backup from ${new Date(data.backupDate).toLocaleString()}?\n\nThis will replace all current data!`)) {
                            setEmployees(data.employees || []);
                            setCategories(data.categories || ['SIM', 'Hardware', 'Accessories']);
                            setCompanyStock(data.companyStock || []);
                            setAllocations(data.allocations || []);
                            setTransactions(data.transactions || []);
                            alert('‚úÖ Backup restored successfully!');
                        }
                    } catch (error) {
                        alert('‚ùå Invalid backup file!');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            // Login Screen Component
            const LoginScreen = () => {
                const [username, setUsername] = useState('');
                const [password, setPassword] = useState('');
                const [error, setError] = useState('');

                const handleSubmit = (e) => {
                    e.preventDefault();
                    setError('');
                    if (handleLogin(username, password)) {
                        setUsername('');
                        setPassword('');
                    } else {
                        setError('Invalid username or password');
                    }
                };

                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-2xl p-8 w-full max-w-md">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Inventory System</h1>
                                <p className="text-gray-600">Sign in to continue</p>
                            </div>
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Username</label>
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Enter username"
                                        required
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Password</label>
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Enter password"
                                        required
                                    />
                                </div>
                                {error && (
                                    <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
                                        {error}
                                    </div>
                                )}
                                <button
                                    type="submit"
                                    className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200"
                                >
                                    Sign In
                                </button>
                            </form>
                            <div className="mt-6 text-center text-sm text-gray-600">
                                <p>Developed by <strong>Nazisad Rahman Nirjon</strong> |                    Designation <strong>IT Analyst, Firoza Global Trading Limited.</strong></p>
                            </div>
                        </div>
                    </div>
                );
            };

            // User Management Component (Admin Only)
            const UserManagement = () => {
                const [newUsername, setNewUsername] = useState('');
                const [newPassword, setNewPassword] = useState('');
                const [newRole, setNewRole] = useState('user');
                const [editingUser, setEditingUser] = useState(null);
                const [editPassword, setEditPassword] = useState('');

                const handleAddUser = (e) => {
                    e.preventDefault();
                    if (users.find(u => u.username === newUsername)) {
                        alert('Username already exists!');
                        return;
                    }
                    const newUser = {
                        id: 'USER' + Date.now(),
                        username: newUsername,
                        password: newPassword,
                        role: newRole,
                        createdAt: new Date().toISOString()
                    };
                    const updatedUsers = [...users, newUser];
                    setUsers(updatedUsers);
                    localStorage.setItem('inventoryUsers', JSON.stringify(updatedUsers));
                    setNewUsername('');
                    setNewPassword('');
                    setNewRole('user');
                    alert('‚úÖ User added successfully!');
                };

                const handleDeleteUser = (userId) => {
                    if (userId === currentUser.id) {
                        alert('Cannot delete your own account!');
                        return;
                    }
                    if (confirm('Are you sure you want to delete this user?')) {
                        const updatedUsers = users.filter(u => u.id !== userId);
                        setUsers(updatedUsers);
                        localStorage.setItem('inventoryUsers', JSON.stringify(updatedUsers));
                    }
                };

                const handlePromoteUser = (userId, newRole) => {
                    const updatedUsers = users.map(u => u.id === userId ? { ...u, role: newRole } : u);
                    setUsers(updatedUsers);
                    localStorage.setItem('inventoryUsers', JSON.stringify(updatedUsers));
                    if (userId === currentUser.id) {
                        setCurrentUser({ ...currentUser, role: newRole });
                    }
                    alert(`‚úÖ User ${newRole === 'admin' ? 'promoted to admin' : 'demoted to user'}!`);
                };

                const handleChangePassword = (userId) => {
                    if (!editPassword) {
                        alert('Please enter a new password!');
                        return;
                    }
                    const updatedUsers = users.map(u => u.id === userId ? { ...u, password: editPassword } : u);
                    setUsers(updatedUsers);
                    localStorage.setItem('inventoryUsers', JSON.stringify(updatedUsers));
                    setEditingUser(null);
                    setEditPassword('');
                    alert('‚úÖ Password changed successfully!');
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-6">üë• User Management</h2>

                        {/* Add New User */}
                        <div className="bg-blue-50 border border-blue-200 p-4 rounded-lg mb-6">
                            <h3 className="text-xl font-bold mb-4">Add New User</h3>
                            <form onSubmit={handleAddUser} className="space-y-3">
                                <div className="grid grid-cols-3 gap-3">
                                    <input
                                        type="text"
                                        value={newUsername}
                                        onChange={(e) => setNewUsername(e.target.value)}
                                        placeholder="Username"
                                        className="p-2 border rounded"
                                        required
                                    />
                                    <input
                                        type="password"
                                        value={newPassword}
                                        onChange={(e) => setNewPassword(e.target.value)}
                                        placeholder="Password"
                                        className="p-2 border rounded"
                                        required
                                    />
                                    <select
                                        value={newRole}
                                        onChange={(e) => setNewRole(e.target.value)}
                                        className="p-2 border rounded"
                                    >
                                        <option value="user">User (View Only)</option>
                                        <option value="admin">Admin (Full Access)</option>
                                    </select>
                                </div>
                                <button type="submit" className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
                                    Add User
                                </button>
                            </form>
                        </div>

                        {/* User List */}
                        <div>
                            <h3 className="text-xl font-bold mb-4">All Users ({users.length})</h3>
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="border p-2">Username</th>
                                        <th className="border p-2">Role</th>
                                        <th className="border p-2">Created</th>
                                        <th className="border p-2">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {users.map(user => (
                                        <tr key={user.id} className={user.id === currentUser.id ? 'bg-yellow-50' : ''}>
                                            <td className="border p-2">
                                                {user.username}
                                                {user.id === currentUser.id && <span className="ml-2 text-xs bg-green-200 px-2 py-1 rounded">You</span>}
                                            </td>
                                            <td className="border p-2">
                                                <span className={`px-3 py-1 rounded font-semibold ${user.role === 'admin' ? 'bg-purple-200 text-purple-800' : 'bg-gray-200 text-gray-800'}`}>
                                                    {user.role}
                                                </span>
                                            </td>
                                            <td className="border p-2 text-sm">{new Date(user.createdAt).toLocaleDateString()}</td>
                                            <td className="border p-2">
                                                <div className="flex gap-2 justify-center">
                                                    {editingUser === user.id ? (
                                                        <div className="flex gap-2 items-center">
                                                            <input
                                                                type="password"
                                                                value={editPassword}
                                                                onChange={(e) => setEditPassword(e.target.value)}
                                                                placeholder="New password"
                                                                className="p-1 border rounded text-sm"
                                                            />
                                                            <button
                                                                onClick={() => handleChangePassword(user.id)}
                                                                className="bg-green-600 text-white px-2 py-1 rounded text-sm hover:bg-green-700"
                                                            >
                                                                Save
                                                            </button>
                                                            <button
                                                                onClick={() => {
                                                                    setEditingUser(null);
                                                                    setEditPassword('');
                                                                }}
                                                                className="bg-gray-600 text-white px-2 py-1 rounded text-sm hover:bg-gray-700"
                                                            >
                                                                Cancel
                                                            </button>
                                                        </div>
                                                    ) : (
                                                        <>
                                                            <button
                                                                onClick={() => setEditingUser(user.id)}
                                                                className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                                            >
                                                                Change Password
                                                            </button>
                                                            {user.id !== currentUser.id && (
                                                                <>
                                                                    <button
                                                                        onClick={() => handlePromoteUser(user.id, user.role === 'admin' ? 'user' : 'admin')}
                                                                        className={`px-3 py-1 rounded text-sm text-white ${user.role === 'admin' ? 'bg-orange-600 hover:bg-orange-700' : 'bg-purple-600 hover:bg-purple-700'}`}
                                                                    >
                                                                        {user.role === 'admin' ? 'Demote' : 'Promote'}
                                                                    </button>
                                                                    <button
                                                                        onClick={() => handleDeleteUser(user.id)}
                                                                        className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700"
                                                                    >
                                                                        Delete
                                                                    </button>
                                                                </>
                                                            )}
                                                        </>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            const BackupSettings = () => {
                const [token, setToken] = useState(githubConfig.token);
                const [username, setUsername] = useState(githubConfig.username);
                const [repo, setRepo] = useState(githubConfig.repo);

                const saveGitHubConfig = () => {
                    const config = { token, username, repo, configured: true, autoBackup: autoBackupEnabled };
                    setGithubConfig(config);
                    localStorage.setItem('githubConfig', JSON.stringify(config));
                    alert('‚úÖ GitHub configuration saved!');
                };

                const testConnection = async () => {
                    try {
                        const response = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        if (response.ok) {
                            alert('‚úÖ Connection successful!');
                        } else {
                            alert('‚ùå Connection failed! Check your settings.');
                        }
                    } catch (error) {
                        alert('‚ùå Connection error: ' + error.message);
                    }
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">Backup & Restore</h2>

                        <div className="space-y-6">
                            <div className="border rounded-lg p-4">
                                <h3 className="text-xl font-bold mb-3">üìÅ Local Backup (Download/Upload)</h3>
                                <div className="flex gap-3">
                                    <button onClick={downloadBackup} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                        Download Backup File
                                    </button>
                                    {isAdmin() && (
                                        <label className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 cursor-pointer">
                                            Upload Backup File
                                            <input type="file" accept=".json" onChange={uploadBackup} className="hidden" />
                                        </label>
                                    )}
                                </div>
                                <p className="text-sm text-gray-600 mt-2">Download backup file and keep it safe. {isAdmin() ? 'Use upload to restore data.' : '(Upload restricted to admins)'}</p>
                            </div>

                            {isAdmin() && (
                                <>
                                    <div className="border rounded-lg p-4">
                                        <h3 className="text-xl font-bold mb-3">üîÑ GitHub Backup (Auto Save)</h3>
                                        
                                        <div className="bg-yellow-50 border border-yellow-200 p-3 rounded mb-4">
                                            <p className="text-sm font-semibold mb-2">üìã Setup Instructions:</p>
                                            <ol className="text-sm space-y-1 ml-4 list-decimal">
                                                <li>Go to <a href="https://github.com" target="_blank" className="text-blue-600 underline">GitHub.com</a></li>
                                                <li>Create a new repository (can be private)</li>
                                                <li>Go to Settings ‚Üí Developer settings ‚Üí Personal access tokens ‚Üí Tokens (classic)</li>
                                                <li>Generate new token with "repo" permission</li>
                                                <li>Copy token and paste below</li>
                                            </ol>
                                        </div>

                                        <div className="space-y-3">
                                            <div>
                                                <label className="block mb-1 font-semibold">GitHub Username</label>
                                                <input type="text" value={username} onChange={e => setUsername(e.target.value)} placeholder="your-github-username" className="w-full p-2 border rounded" />
                                            </div>
                                            <div>
                                                <label className="block mb-1 font-semibold">Repository Name</label>
                                                <input type="text" value={repo} onChange={e => setRepo(e.target.value)} placeholder="inventory-backup" className="w-full p-2 border rounded" />
                                            </div>
                                            <div>
                                                <label className="block mb-1 font-semibold">Personal Access Token</label>
                                                <input type="password" value={token} onChange={e => setToken(e.target.value)} placeholder="ghp_xxxxxxxxxxxx" className="w-full p-2 border rounded" />
                                            </div>

                                            <div className="flex items-center gap-2 p-3 bg-gray-50 rounded">
                                                <input type="checkbox" id="autoBackup" checked={autoBackupEnabled} onChange={e => setAutoBackupEnabled(e.target.checked)} className="w-4 h-4" />
                                                <label htmlFor="autoBackup" className="font-semibold">Enable Auto Backup (saves every change to GitHub)</label>
                                            </div>

                                            <div className="flex gap-3">
                                                <button onClick={saveGitHubConfig} className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                                    Save Configuration
                                                </button>
                                                <button onClick={testConnection} className="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                                                    Test Connection
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    {githubConfig.configured && (
                                        <div className="border rounded-lg p-4 bg-green-50">
                                            <h3 className="text-xl font-bold mb-3">‚úÖ GitHub Connected</h3>
                                            <div className="flex gap-3">
                                                <button onClick={() => saveToGitHub({ employees, categories, companyStock, allocations, transactions })} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                                    Backup Now to GitHub
                                                </button>
                                                <button onClick={restoreFromGitHub} className="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                                                    Restore from GitHub
                                                </button>
                                            </div>
                                            <p className="text-sm text-gray-600 mt-2">
                                                {autoBackupEnabled ? 'üü¢ Auto backup is ON - Data saves automatically' : 'üî¥ Auto backup is OFF - Use manual backup'}
                                            </p>
                                        </div>
                                    )}
                                </>
                            )}

                            <div className="border rounded-lg p-4 bg-blue-50">
                                <h3 className="text-xl font-bold mb-3">üöÄ Migration Guide</h3>
                                <div className="text-sm space-y-2">
                                    <p><strong>To migrate to a new host:</strong></p>
                                    <ol className="ml-4 list-decimal space-y-1">
                                        <li>Download backup file OR ensure GitHub backup is saved</li>
                                        <li>Upload this HTML file to new hosting platform</li>
                                        <li>Open the website</li>
                                        <li>Go to Backup & Restore</li>
                                        <li>Either upload the backup file OR configure GitHub and restore</li>
                                        <li>All data will be restored!</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const Dashboard = () => (
                <div className="bg-white p-6 rounded-lg shadow">
                    <h2 className="text-2xl font-bold mb-6">Dashboard</h2>
                    <div className="grid grid-cols-4 gap-4 mb-6">
                        <div className="bg-blue-50 p-4 rounded border border-blue-200">
                            <p className="text-gray-600 text-sm">Employees</p>
                            <p className="text-3xl font-bold text-blue-700">{employees.length}</p>
                        </div>
                        <div className="bg-green-50 p-4 rounded border border-green-200">
                            <p className="text-gray-600 text-sm">Company Stock</p>
                            <p className="text-3xl font-bold text-green-700">{companyStock.length}</p>
                        </div>
                        <div className="bg-orange-50 p-4 rounded border border-orange-200">
                            <p className="text-gray-600 text-sm">Allocated</p>
                            <p className="text-3xl font-bold text-orange-700">{allocations.length}</p>
                        </div>
                        <div className="bg-purple-50 p-4 rounded border border-purple-200">
                            <p className="text-gray-600 text-sm">Total Stock</p>
                            <p className="text-3xl font-bold text-purple-700">{companyStock.length + allocations.length}</p>
                        </div>
                    </div>
                    {githubConfig.configured && (
                        <div className="bg-green-100 border border-green-300 p-3 rounded">
                            <p className="font-semibold">‚úÖ GitHub Backup: Connected</p>
                            <p className="text-sm text-gray-700">
                                {autoBackupEnabled ? 'üü¢ Auto backup enabled - Your data is safe!' : 'üî¥ Auto backup disabled - Enable in Backup Settings'}
                            </p>
                        </div>
                    )}
                </div>
            );

            const EmployeeRegistration = () => {
                const [empType, setEmpType] = useState('DSR');
                const [name, setName] = useState('');
                const [id1, setId1] = useState('');
                const [id2, setId2] = useState('');
                const [phone1, setPhone1] = useState('');
                const [phone2, setPhone2] = useState('');
                const [numberId, setNumberId] = useState('');

                const handleSubmit = (e) => {
                    e.preventDefault();
                    const newEmp = {
                        empId: 'EMP' + Date.now(),
                        name, type: empType,
                        id1, id2, phone1, phone2, numberId,
                        createdAt: new Date().toISOString()
                    };
                    setEmployees([...employees, newEmp]);
                    setName(''); setId1(''); setId2(''); setPhone1(''); setPhone2(''); setNumberId('');
                    alert('Employee registered!');
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">Employee Registration</h2>
                        {!isAdmin() && (
                            <div className="bg-yellow-50 border border-yellow-300 p-3 rounded mb-4">
                                <p className="text-sm font-semibold">‚ö†Ô∏è View Only Mode - Admin access required to make changes</p>
                            </div>
                        )}
                        {isAdmin() && (
                            <form onSubmit={handleSubmit} className="space-y-4 mb-8">
                                <div>
                                    <label className="block mb-2 font-semibold">Employee Type</label>
                                    <select value={empType} onChange={e => setEmpType(e.target.value)} className="w-full p-2 border rounded">
                                        <option value="DSR">DSR</option>
                                        <option value="BP">BP</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block mb-2 font-semibold">Name</label>
                                    <input type="text" value={name} onChange={e => setName(e.target.value)} className="w-full p-2 border rounded" required />
                                </div>
                                {empType === 'DSR' ? (
                                    <>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block mb-2 font-semibold">ID 1</label>
                                                <input type="text" value={id1} onChange={e => setId1(e.target.value)} className="w-full p-2 border rounded" required />
                                            </div>
                                            <div>
                                                <label className="block mb-2 font-semibold">ID 2</label>
                                                <input type="text" value={id2} onChange={e => setId2(e.target.value)} className="w-full p-2 border rounded" required />
                                            </div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block mb-2 font-semibold">Phone 1</label>
                                                <input type="text" value={phone1} onChange={e => setPhone1(e.target.value)} className="w-full p-2 border rounded" required />
                                            </div>
                                            <div>
                                                <label className="block mb-2 font-semibold">Phone 2</label>
                                                <input type="text" value={phone2} onChange={e => setPhone2(e.target.value)} className="w-full p-2 border rounded" required />
                                            </div>
                                        </div>
                                    </>
                                ) : (
                                    <div>
                                        <label className="block mb-2 font-semibold">Number ID</label>
                                        <input type="text" value={numberId} onChange={e => setNumberId(e.target.value)} className="w-full p-2 border rounded" required />
                                    </div>
                                )}
                                <button type="submit" className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Register Employee</button>
                            </form>
                        )}

                        <div>
                            <h3 className="text-xl font-bold mb-4">Registered Employees ({employees.length})</h3>
                            <table className="w-full border-collapse">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="border p-2">Name</th>
                                        <th className="border p-2">Type</th>
                                        <th className="border p-2">Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {employees.map(emp => (
                                        <tr key={emp.empId}>
                                            <td className="border p-2">{emp.name}</td>
                                            <td className="border p-2">{emp.type}</td>
                                            <td className="border p-2">
                                                {emp.type === 'DSR' 
                                                    ? `ID: ${emp.id1}, ${emp.id2} | Ph: ${emp.phone1}, ${emp.phone2}`
                                                    : `ID: ${emp.numberId}`}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            const AddStock = () => {
                const [entryMode, setEntryMode] = useState('continuous');
                const [category, setCategory] = useState(categories[0] || '');
                const [newCategory, setNewCategory] = useState('');
                const [productName, setProductName] = useState('');
                const [serialStart, setSerialStart] = useState('');
                const [serialEnd, setSerialEnd] = useState('');
                const [singleSerial, setSingleSerial] = useState('');
                const [searchTerm, setSearchTerm] = useState('');
                const [selectedItems, setSelectedItems] = useState([]);

                const handleAddCategory = () => {
                    if (newCategory && !categories.includes(newCategory)) {
                        setCategories([...categories, newCategory]);
                        setCategory(newCategory);
                        setNewCategory('');
                    }
                };

                const handleAddStock = (e) => {
                    e.preventDefault();
                    const newProducts = [];
                    const timestamp = new Date().toISOString();

                    if (entryMode === 'continuous') {
                        const start = parseInt(serialStart);
                        const end = parseInt(serialEnd);
                        if (isNaN(start) || isNaN(end) || start > end) {
                            alert('Invalid serial range');
                            return;
                        }
                        for (let i = start; i <= end; i++) {
                            const serial = i.toString();
                            if (companyStock.some(p => p.serial === serial) || allocations.some(a => a.serial === serial)) {
                                alert(`Serial ${serial} already exists`);
                                return;
                            }
                        }
                        for (let i = start; i <= end; i++) {
                            newProducts.push({
                                id: 'PROD' + Date.now() + i,
                                name: productName,
                                category,
                                serial: i.toString(),
                                addedAt: timestamp
                            });
                        }
                    } else {
                        if (companyStock.some(p => p.serial === singleSerial) || allocations.some(a => a.serial === singleSerial)) {
                            alert(`Serial ${singleSerial} already exists`);
                            return;
                        }
                        newProducts.push({
                            id: 'PROD' + Date.now(),
                            name: productName,
                            category,
                            serial: singleSerial,
                            addedAt: timestamp
                        });
                    }

                    setCompanyStock([...companyStock, ...newProducts]);
                    setTransactions([{
                        id: 'TXN' + Date.now(),
                        type: 'stock-added',
                        productCount: newProducts.length,
                        category,
                        productName,
                        serials: newProducts.map(p => p.serial),
                        timestamp
                    }, ...transactions]);

                    setSerialStart('');
                    setSerialEnd('');
                    setSingleSerial('');
                    setProductName('');
                    alert(`${newProducts.length} products added!`);
                };

                const handleSelectItem = (productId) => {
                    setSelectedItems(prev => 
                        prev.includes(productId) 
                            ? prev.filter(id => id !== productId)
                            : [...prev, productId]
                    );
                };

                const handleSelectAll = () => {
                    const filteredProducts = companyStock.filter(p => p.serial.includes(searchTerm));
                    if (selectedItems.length === filteredProducts.length) {
                        setSelectedItems([]);
                    } else {
                        setSelectedItems(filteredProducts.map(p => p.id));
                    }
                };

                const handleDeleteSelected = () => {
                    if (selectedItems.length === 0) {
                        alert('Please select items to delete');
                        return;
                    }

                    const itemsToDelete = companyStock.filter(p => selectedItems.includes(p.id));
                    const serialsList = itemsToDelete.map(p => p.serial).join(', ');
                    
                    if (confirm(`Are you sure you want to delete ${selectedItems.length} item(s)?\n\nSerials: ${serialsList}\n\nThis action cannot be undone!`)) {
                        const updatedStock = companyStock.filter(p => !selectedItems.includes(p.id));
                        setCompanyStock(updatedStock);
                        
                        setTransactions([{
                            id: 'TXN' + Date.now(),
                            type: 'stock-deleted',
                            productCount: selectedItems.length,
                            serials: itemsToDelete.map(p => p.serial),
                            timestamp: new Date().toISOString()
                        }, ...transactions]);

                        setSelectedItems([]);
                        alert(`‚úÖ ${selectedItems.length} item(s) deleted successfully!`);
                    }
                };

                const handleDeleteSingle = (product) => {
                    if (confirm(`Delete this item?\n\nSerial: ${product.serial}\nProduct: ${product.name}\n\nThis action cannot be undone!`)) {
                        const updatedStock = companyStock.filter(p => p.id !== product.id);
                        setCompanyStock(updatedStock);
                        
                        setTransactions([{
                            id: 'TXN' + Date.now(),
                            type: 'stock-deleted',
                            productCount: 1,
                            productName: product.name,
                            serials: [product.serial],
                            timestamp: new Date().toISOString()
                        }, ...transactions]);

                        alert('‚úÖ Item deleted successfully!');
                    }
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">Add Stock to Company</h2>
                        
                        {!isAdmin() && (
                            <div className="bg-yellow-50 border border-yellow-300 p-3 rounded mb-4">
                                <p className="text-sm font-semibold">‚ö†Ô∏è View Only Mode - Admin access required to add stock</p>
                            </div>
                        )}

                        {isAdmin() && (
                            <>
                                <div className="mb-4">
                                    <label className="block mb-2 font-semibold">Category</label>
                                    <div className="flex gap-2">
                                        <select value={category} onChange={e => setCategory(e.target.value)} className="flex-1 p-2 border rounded">
                                            {categories.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                        </select>
                                        <input type="text" placeholder="New category" value={newCategory} onChange={e => setNewCategory(e.target.value)} className="flex-1 p-2 border rounded" />
                                        <button onClick={handleAddCategory} className="bg-green-600 text-white px-4 rounded hover:bg-green-700">Add</button>
                                    </div>
                                </div>

                                <form onSubmit={handleAddStock} className="space-y-4 mb-8">
                                    <div>
                                        <label className="block mb-2 font-semibold">Product Name</label>
                                        <input type="text" value={productName} onChange={e => setProductName(e.target.value)} className="w-full p-2 border rounded" required />
                                    </div>

                                    <div>
                                        <label className="block mb-2 font-semibold">Entry Mode</label>
                                        <div className="flex gap-4">
                                            <label className="flex items-center">
                                                <input type="radio" value="continuous" checked={entryMode === 'continuous'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                                Continuous Serial
                                            </label>
                                            <label className="flex items-center">
                                                <input type="radio" value="single" checked={entryMode === 'single'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                                Single Entry
                                            </label>
                                        </div>
                                    </div>

                                    {entryMode === 'continuous' ? (
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block mb-2 font-semibold">Serial Start</label>
                                                <input type="text" value={serialStart} onChange={e => setSerialStart(e.target.value)} className="w-full p-2 border rounded" placeholder="e.g., 1200" required />
                                            </div>
                                            <div>
                                                <label className="block mb-2 font-semibold">Serial End</label>
                                                <input type="text" value={serialEnd} onChange={e => setSerialEnd(e.target.value)} className="w-full p-2 border rounded" placeholder="e.g., 1210" required />
                                            </div>
                                        </div>
                                    ) : (
                                        <div>
                                            <label className="block mb-2 font-semibold">Serial Number</label>
                                            <input type="text" value={singleSerial} onChange={e => setSingleSerial(e.target.value)} className="w-full p-2 border rounded" placeholder="e.g., 1234" required />
                                        </div>
                                    )}

                                    <button type="submit" className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Add to Stock</button>
                                </form>
                            </>
                        )}

                        <div>
                            <h3 className="text-xl font-bold mb-4">Company Stock ({companyStock.length} items)</h3>
                            <input type="text" placeholder="Search by serial..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full p-2 border rounded mb-4" />
                            
                            {isAdmin() && companyStock.length > 0 && (
                                <div className="flex gap-3 mb-4">
                                    <button 
                                        onClick={handleSelectAll}
                                        className="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
                                    >
                                        {selectedItems.length === companyStock.filter(p => p.serial.includes(searchTerm)).length ? 'Deselect All' : 'Select All'}
                                    </button>
                                    <button 
                                        onClick={handleDeleteSelected}
                                        className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
                                        disabled={selectedItems.length === 0}
                                    >
                                        üóëÔ∏è Delete Selected ({selectedItems.length})
                                    </button>
                                </div>
                            )}

                            <div className="max-h-96 overflow-y-auto">
                                <table className="w-full border-collapse">
                                    <thead className="sticky top-0 bg-gray-100">
                                        <tr>
                                            {isAdmin() && <th className="border p-2 w-12">Select</th>}
                                            <th className="border p-2">Serial</th>
                                            <th className="border p-2">Product</th>
                                            <th className="border p-2">Category</th>
                                            <th className="border p-2">Added</th>
                                            {isAdmin() && <th className="border p-2">Action</th>}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {companyStock.filter(p => p.serial.includes(searchTerm)).map(product => (
                                            <tr key={product.id} className={selectedItems.includes(product.id) ? 'bg-red-50' : ''}>
                                                {isAdmin() && (
                                                    <td className="border p-2 text-center">
                                                        <input 
                                                            type="checkbox"
                                                            checked={selectedItems.includes(product.id)}
                                                            onChange={() => handleSelectItem(product.id)}
                                                            className="w-4 h-4 cursor-pointer"
                                                        />
                                                    </td>
                                                )}
                                                <td className="border p-2">{product.serial}</td>
                                                <td className="border p-2">{product.name}</td>
                                                <td className="border p-2">{product.category}</td>
                                                <td className="border p-2">{new Date(product.addedAt).toLocaleString()}</td>
                                                {isAdmin() && (
                                                    <td className="border p-2 text-center">
                                                        <button 
                                                            onClick={() => handleDeleteSingle(product)}
                                                            className="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600"
                                                        >
                                                            Delete
                                                        </button>
                                                    </td>
                                                )}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            };

            const AllocateStock = () => {
                const [selectedEmployee, setSelectedEmployee] = useState('');
                const [entryMode, setEntryMode] = useState('continuous');
                const [serialStart, setSerialStart] = useState('');
                const [serialEnd, setSerialEnd] = useState('');
                const [singleSerial, setSingleSerial] = useState('');

                const handleAllocate = (e) => {
                    e.preventDefault();
                    if (!selectedEmployee) {
                        alert('Please select an employee');
                        return;
                    }

                    const employee = employees.find(emp => emp.empId === selectedEmployee);
                    const serialsToAllocate = [];
                    const timestamp = new Date().toISOString();

                    if (entryMode === 'continuous') {
                        const start = parseInt(serialStart);
                        const end = parseInt(serialEnd);
                        if (isNaN(start) || isNaN(end) || start > end) {
                            alert('Invalid serial range');
                            return;
                        }
                        for (let i = start; i <= end; i++) {
                            serialsToAllocate.push(i.toString());
                        }
                    } else {
                        serialsToAllocate.push(singleSerial);
                    }

                    const missingSerials = [];
                    const allocatedSerials = [];

                    for (const serial of serialsToAllocate) {
                        const inStock = companyStock.find(p => p.serial === serial);
                        const alreadyAllocated = allocations.find(a => a.serial === serial);
                        if (!inStock) missingSerials.push(serial);
                        else if (alreadyAllocated) allocatedSerials.push(serial);
                    }

                    if (missingSerials.length > 0) {
                        alert(`Serials not in stock: ${missingSerials.join(', ')}`);
                        return;
                    }
                    if (allocatedSerials.length > 0) {
                        alert(`Serials already allocated: ${allocatedSerials.join(', ')}`);
                        return;
                    }

                    const newAllocations = [];
                    const updatedStock = companyStock.filter(p => {
                        if (serialsToAllocate.includes(p.serial)) {
                            newAllocations.push({
                                ...p,
                                employeeId: employee.empId,
                                employeeName: employee.name,
                                allocatedAt: timestamp
                            });
                            return false;
                        }
                        return true;
                    });

                    setCompanyStock(updatedStock);
                    setAllocations([...allocations, ...newAllocations]);
                    setTransactions([{
                        id: 'TXN' + Date.now(),
                        type: 'allocated',
                        employeeName: employee.name,
                        productCount: newAllocations.length,
                        serials: serialsToAllocate,
                        timestamp
                    }, ...transactions]);

                    setSerialStart('');
                    setSerialEnd('');
                    setSingleSerial('');
                    alert(`${newAllocations.length} products allocated to ${employee.name}!`);
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">Allocate Stock to Employee</h2>
                        {!isAdmin() ? (
                            <div className="bg-yellow-50 border border-yellow-300 p-3 rounded mb-4">
                                <p className="text-sm font-semibold">‚ö†Ô∏è View Only Mode - Admin access required to allocate stock</p>
                            </div>
                        ) : (
                            <form onSubmit={handleAllocate} className="space-y-4">
                                <div>
                                    <label className="block mb-2 font-semibold">Select Employee</label>
                                    <select value={selectedEmployee} onChange={e => setSelectedEmployee(e.target.value)} className="w-full p-2 border rounded" required>
                                        <option value="">-- Select Employee --</option>
                                        {employees.map(emp => (
                                            <option key={emp.empId} value={emp.empId}>{emp.name} ({emp.type})</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block mb-2 font-semibold">Entry Mode</label>
                                    <div className="flex gap-4">
                                        <label className="flex items-center">
                                            <input type="radio" value="continuous" checked={entryMode === 'continuous'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                            Continuous Serial
                                        </label>
                                        <label className="flex items-center">
                                            <input type="radio" value="single" checked={entryMode === 'single'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                            Single Entry
                                        </label>
                                    </div>
                                </div>

                                {entryMode === 'continuous' ? (
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block mb-2 font-semibold">Serial Start</label>
                                            <input type="text" value={serialStart} onChange={e => setSerialStart(e.target.value)} className="w-full p-2 border rounded" required />
                                        </div>
                                        <div>
                                            <label className="block mb-2 font-semibold">Serial End</label>
                                            <input type="text" value={serialEnd} onChange={e => setSerialEnd(e.target.value)} className="w-full p-2 border rounded" required />
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <label className="block mb-2 font-semibold">Serial Number</label>
                                        <input type="text" value={singleSerial} onChange={e => setSingleSerial(e.target.value)} className="w-full p-2 border rounded" required />
                                    </div>
                                )}

                                <button type="submit" className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Allocate to Employee</button>
                            </form>
                        )}
                    </div>
                );
            };

            const DeleteStock = () => {
                const [entryMode, setEntryMode] = useState('continuous');
                const [serialStart, setSerialStart] = useState('');
                const [serialEnd, setSerialEnd] = useState('');
                const [singleSerial, setSingleSerial] = useState('');
                const [searchTerm, setSearchTerm] = useState('');
                const [selectedItems, setSelectedItems] = useState([]);

                const handleDelete = (e) => {
                    e.preventDefault();
                    
                    const serialsToDelete = [];
                    
                    if (entryMode === 'continuous') {
                        const start = parseInt(serialStart);
                        const end = parseInt(serialEnd);
                        if (isNaN(start) || isNaN(end) || start > end) {
                            alert('Invalid serial range');
                            return;
                        }
                        for (let i = start; i <= end; i++) {
                            serialsToDelete.push(i.toString());
                        }
                    } else {
                        serialsToDelete.push(singleSerial);
                    }

                    const itemsToDelete = companyStock.filter(p => serialsToDelete.includes(p.serial));
                    const notFound = serialsToDelete.filter(s => !companyStock.some(p => p.serial === s));

                    if (notFound.length > 0) {
                        alert(`Serials not found in company stock: ${notFound.join(', ')}`);
                        return;
                    }

                    if (itemsToDelete.length === 0) {
                        alert('No items found to delete');
                        return;
                    }

                    const serialsList = itemsToDelete.map(p => `${p.serial} (${p.name})`).join('\n');
                    
                    if (confirm(`Are you sure you want to delete ${itemsToDelete.length} item(s)?\n\n${serialsList}\n\nThis action cannot be undone!`)) {
                        const updatedStock = companyStock.filter(p => !serialsToDelete.includes(p.serial));
                        setCompanyStock(updatedStock);
                        
                        setTransactions([{
                            id: 'TXN' + Date.now(),
                            type: 'stock-deleted',
                            productCount: itemsToDelete.length,
                            serials: serialsToDelete,
                            timestamp: new Date().toISOString()
                        }, ...transactions]);

                        setSerialStart('');
                        setSerialEnd('');
                        setSingleSerial('');
                        alert(`‚úÖ ${itemsToDelete.length} item(s) deleted successfully!`);
                    }
                };

                const handleSelectItem = (productId) => {
                    setSelectedItems(prev => 
                        prev.includes(productId) 
                            ? prev.filter(id => id !== productId)
                            : [...prev, productId]
                    );
                };

                const handleSelectAll = () => {
                    const filteredProducts = companyStock.filter(p => p.serial.includes(searchTerm));
                    if (selectedItems.length === filteredProducts.length) {
                        setSelectedItems([]);
                    } else {
                        setSelectedItems(filteredProducts.map(p => p.id));
                    }
                };

                const handleDeleteSelected = () => {
                    if (selectedItems.length === 0) {
                        alert('Please select items to delete');
                        return;
                    }

                    const itemsToDelete = companyStock.filter(p => selectedItems.includes(p.id));
                    const serialsList = itemsToDelete.map(p => `${p.serial} - ${p.name}`).join('\n');
                    
                    if (confirm(`Are you sure you want to delete ${selectedItems.length} item(s)?\n\n${serialsList}\n\nThis action cannot be undone!`)) {
                        const updatedStock = companyStock.filter(p => !selectedItems.includes(p.id));
                        setCompanyStock(updatedStock);
                        
                        setTransactions([{
                            id: 'TXN' + Date.now(),
                            type: 'stock-deleted',
                            productCount: selectedItems.length,
                            serials: itemsToDelete.map(p => p.serial),
                            timestamp: new Date().toISOString()
                        }, ...transactions]);

                        setSelectedItems([]);
                        alert(`‚úÖ ${selectedItems.length} item(s) deleted successfully!`);
                    }
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">üóëÔ∏è Delete Stock from Company</h2>
                        
                        {!isAdmin() ? (
                            <div className="bg-yellow-50 border border-yellow-300 p-3 rounded mb-4">
                                <p className="text-sm font-semibold">‚ö†Ô∏è View Only Mode - Admin access required to delete stock</p>
                            </div>
                        ) : (
                            <>
                                <div className="bg-red-50 border border-red-300 p-4 rounded mb-6">
                                    <p className="text-sm font-semibold text-red-700">‚ö†Ô∏è Warning: Deleted stock cannot be recovered. Only delete items added by mistake.</p>
                                </div>

                                <form onSubmit={handleDelete} className="space-y-4 mb-8">
                                    <div>
                                        <label className="block mb-2 font-semibold">Entry Mode</label>
                                        <div className="flex gap-4">
                                            <label className="flex items-center">
                                                <input type="radio" value="continuous" checked={entryMode === 'continuous'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                                Continuous Serial
                                            </label>
                                            <label className="flex items-center">
                                                <input type="radio" value="single" checked={entryMode === 'single'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                                Single Entry
                                            </label>
                                        </div>
                                    </div>

                                    {entryMode === 'continuous' ? (
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block mb-2 font-semibold">Serial Start</label>
                                                <input type="text" value={serialStart} onChange={e => setSerialStart(e.target.value)} className="w-full p-2 border rounded" placeholder="e.g., 1200" required />
                                            </div>
                                            <div>
                                                <label className="block mb-2 font-semibold">Serial End</label>
                                                <input type="text" value={serialEnd} onChange={e => setSerialEnd(e.target.value)} className="w-full p-2 border rounded" placeholder="e.g., 1210" required />
                                            </div>
                                        </div>
                                    ) : (
                                        <div>
                                            <label className="block mb-2 font-semibold">Serial Number</label>
                                            <input type="text" value={singleSerial} onChange={e => setSingleSerial(e.target.value)} className="w-full p-2 border rounded" placeholder="e.g., 1234" required />
                                        </div>
                                    )}

                                    <button type="submit" className="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
                                        üóëÔ∏è Delete from Stock
                                    </button>
                                </form>

                                <div className="border-t-2 pt-6">
                                    <h3 className="text-xl font-bold mb-4">Or Select Multiple Items to Delete</h3>
                                    <input type="text" placeholder="Search by serial..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full p-2 border rounded mb-4" />
                                    
                                    {companyStock.length > 0 && (
                                        <div className="flex gap-3 mb-4">
                                            <button 
                                                onClick={handleSelectAll}
                                                className="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700"
                                            >
                                                {selectedItems.length === companyStock.filter(p => p.serial.includes(searchTerm)).length && companyStock.filter(p => p.serial.includes(searchTerm)).length > 0 ? 'Deselect All' : 'Select All'}
                                            </button>
                                            <button 
                                                onClick={handleDeleteSelected}
                                                className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed"
                                                disabled={selectedItems.length === 0}
                                            >
                                                üóëÔ∏è Delete Selected ({selectedItems.length})
                                            </button>
                                        </div>
                                    )}

                                    <div className="max-h-96 overflow-y-auto">
                                        <table className="w-full border-collapse">
                                            <thead className="sticky top-0 bg-gray-100">
                                                <tr>
                                                    <th className="border p-2 w-12">Select</th>
                                                    <th className="border p-2">Serial</th>
                                                    <th className="border p-2">Product</th>
                                                    <th className="border p-2">Category</th>
                                                    <th className="border p-2">Added</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {companyStock.filter(p => p.serial.includes(searchTerm)).map(product => (
                                                    <tr key={product.id} className={selectedItems.includes(product.id) ? 'bg-red-50' : ''}>
                                                        <td className="border p-2 text-center">
                                                            <input 
                                                                type="checkbox"
                                                                checked={selectedItems.includes(product.id)}
                                                                onChange={() => handleSelectItem(product.id)}
                                                                className="w-4 h-4 cursor-pointer"
                                                            />
                                                        </td>
                                                        <td className="border p-2">{product.serial}</td>
                                                        <td className="border p-2">{product.name}</td>
                                                        <td className="border p-2">{product.category}</td>
                                                        <td className="border p-2">{new Date(product.addedAt).toLocaleString()}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </>
                        )}

                        <div className="mt-8 border-t-2 pt-6">
                            <h3 className="text-xl font-bold mb-4">Company Stock ({companyStock.length} items)</h3>
                            <p className="text-sm text-gray-600 mb-4">View all items currently in company stock. Use the form above to delete items.</p>
                            <div className="max-h-64 overflow-y-auto">
                                <table className="w-full border-collapse">
                                    <thead className="sticky top-0 bg-gray-100">
                                        <tr>
                                            <th className="border p-2">Serial</th>
                                            <th className="border p-2">Product</th>
                                            <th className="border p-2">Category</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {companyStock.map(product => (
                                            <tr key={product.id}>
                                                <td className="border p-2">{product.serial}</td>
                                                <td className="border p-2">{product.name}</td>
                                                <td className="border p-2">{product.category}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            };

            const ReturnStock = () => {
                const [selectedEmployee, setSelectedEmployee] = useState('');
                const [entryMode, setEntryMode] = useState('continuous');
                const [serialStart, setSerialStart] = useState('');
                const [serialEnd, setSerialEnd] = useState('');
                const [singleSerial, setSingleSerial] = useState('');

                const handleReturn = (e) => {
                    e.preventDefault();
                    if (!selectedEmployee) {
                        alert('Please select an employee');
                        return;
                    }

                    const employee = employees.find(emp => emp.empId === selectedEmployee);
                    const serialsToReturn = [];
                    const timestamp = new Date().toISOString();

                    if (entryMode === 'continuous') {
                        const start = parseInt(serialStart);
                        const end = parseInt(serialEnd);
                        if (isNaN(start) || isNaN(end) || start > end) {
                            alert('Invalid serial range');
                            return;
                        }
                        for (let i = start; i <= end; i++) {
                            serialsToReturn.push(i.toString());
                        }
                    } else {
                        serialsToReturn.push(singleSerial);
                    }

                    const notFound = [];
                    for (const serial of serialsToReturn) {
                        const allocated = allocations.find(a => a.serial === serial && a.employeeId === selectedEmployee);
                        if (!allocated) notFound.push(serial);
                    }

                    if (notFound.length > 0) {
                        alert(`Serials not found with employee: ${notFound.join(', ')}`);
                        return;
                    }

                    const returnedProducts = [];
                    const updatedAllocations = allocations.filter(a => {
                        if (serialsToReturn.includes(a.serial) && a.employeeId === selectedEmployee) {
                            returnedProducts.push({
                                ...a,
                                employeeId: undefined,
                                employeeName: undefined,
                                allocatedAt: undefined,
                                returnedAt: timestamp
                            });
                            return false;
                        }
                        return true;
                    });

                    setAllocations(updatedAllocations);
                    setCompanyStock([...companyStock, ...returnedProducts]);
                    setTransactions([{
                        id: 'TXN' + Date.now(),
                        type: 'returned',
                        employeeName: employee.name,
                        productCount: returnedProducts.length,
                        serials: serialsToReturn,
                        timestamp
                    }, ...transactions]);

                    setSerialStart('');
                    setSerialEnd('');
                    setSingleSerial('');
                    alert(`${returnedProducts.length} products returned from ${employee.name}!`);
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">Return Stock from Employee</h2>
                        {!isAdmin() ? (
                            <div className="bg-yellow-50 border border-yellow-300 p-3 rounded mb-4">
                                <p className="text-sm font-semibold">‚ö†Ô∏è View Only Mode - Admin access required to return stock</p>
                            </div>
                        ) : (
                            <form onSubmit={handleReturn} className="space-y-4">
                                <div>
                                    <label className="block mb-2 font-semibold">Select Employee</label>
                                    <select value={selectedEmployee} onChange={e => setSelectedEmployee(e.target.value)} className="w-full p-2 border rounded" required>
                                        <option value="">-- Select Employee --</option>
                                        {employees.map(emp => (
                                            <option key={emp.empId} value={emp.empId}>{emp.name} ({emp.type})</option>
                                        ))}
                                    </select>
                                </div>

                                <div>
                                    <label className="block mb-2 font-semibold">Entry Mode</label>
                                    <div className="flex gap-4">
                                        <label className="flex items-center">
                                            <input type="radio" value="continuous" checked={entryMode === 'continuous'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                            Continuous Serial
                                        </label>
                                        <label className="flex items-center">
                                            <input type="radio" value="single" checked={entryMode === 'single'} onChange={e => setEntryMode(e.target.value)} className="mr-2" />
                                            Single Entry
                                        </label>
                                    </div>
                                </div>

                                {entryMode === 'continuous' ? (
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block mb-2 font-semibold">Serial Start</label>
                                            <input type="text" value={serialStart} onChange={e => setSerialStart(e.target.value)} className="w-full p-2 border rounded" required />
                                        </div>
                                        <div>
                                            <label className="block mb-2 font-semibold">Serial End</label>
                                            <input type="text" value={serialEnd} onChange={e => setSerialEnd(e.target.value)} className="w-full p-2 border rounded" required />
                                        </div>
                                    </div>
                                ) : (
                                    <div>
                                        <label className="block mb-2 font-semibold">Serial Number</label>
                                        <input type="text" value={singleSerial} onChange={e => setSingleSerial(e.target.value)} className="w-full p-2 border rounded" required />
                                    </div>
                                )}

                                <button type="submit" className="bg-orange-600 text-white px-6 py-2 rounded hover:bg-orange-700">Return to Company</button>
                            </form>
                        )}
                    </div>
                );
            };

            const EmployeeStockView = () => {
                const [selectedEmp, setSelectedEmp] = useState('');

                const exportToExcel = (empId) => {
                    const employee = employees.find(e => e.empId === empId);
                    const empAllocations = allocations.filter(a => a.employeeId === empId);
                    let csv = 'Serial,Product,Category,Allocated Date\n';
                    empAllocations.forEach(item => {
                        csv += `${item.serial},${item.name},${item.category},${new Date(item.allocatedAt).toLocaleString()}\n`;
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${employee.name}_Stock.csv`;
                    a.click();
                    URL.revokeObjectURL(url);
                };

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <h2 className="text-2xl font-bold mb-4">Employee Stock View</h2>
                        <div className="mb-4">
                            <label className="block mb-2 font-semibold">Filter by Employee</label>
                            <select value={selectedEmp} onChange={e => setSelectedEmp(e.target.value)} className="w-full p-2 border rounded">
                                <option value="">-- All Employees --</option>
                                {employees.map(emp => (
                                    <option key={emp.empId} value={emp.empId}>{emp.name} ({emp.type})</option>
                                ))}
                            </select>
                        </div>

                        <div className="space-y-6">
                            {employees.filter(emp => !selectedEmp || emp.empId === selectedEmp).map(emp => {
                                const empStock = allocations.filter(a => a.employeeId === emp.empId);
                                const cats = [...new Set(empStock.map(s => s.category))];
                                
                                return (
                                    <div key={emp.empId} className="border rounded-lg p-4">
                                        <div className="flex justify-between items-center mb-3">
                                            <div>
                                                <h3 className="text-lg font-bold">{emp.name}</h3>
                                                <p className="text-sm text-gray-600">{emp.type} | Total: {empStock.length}</p>
                                            </div>
                                            <button onClick={() => exportToExcel(emp.empId)} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                                Export Excel
                                            </button>
                                        </div>
                                        {cats.map(cat => {
                                            const catItems = empStock.filter(s => s.category === cat);
                                            return (
                                                <div key={cat} className="mb-3">
                                                    <h4 className="font-semibold bg-gray-100 p-2 rounded">{cat} ({catItems.length})</h4>
                                                    <table className="w-full text-sm mt-2">
                                                        <thead>
                                                            <tr className="bg-gray-50">
                                                                <th className="border p-1">Serial</th>
                                                                <th className="border p-1">Product</th>
                                                                <th className="border p-1">Date</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {catItems.map(item => (
                                                                <tr key={item.serial}>
                                                                    <td className="border p-1">{item.serial}</td>
                                                                    <td className="border p-1">{item.name}</td>
                                                                    <td className="border p-1">{new Date(item.allocatedAt).toLocaleString()}</td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            );
                                        })}
                                        {empStock.length === 0 && <p className="text-gray-500 text-center py-4">No stock allocated</p>}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            const HouseStockView = () => {
                const exportHouseStock = () => {
                    let csv = 'Type,Details,Count,Date\n';
                    csv += `Company Stock,Available,${companyStock.length},${new Date().toLocaleString()}\n`;
                    csv += `Employee Stock,Allocated,${allocations.length},${new Date().toLocaleString()}\n\n`;
                    csv += 'Transaction History\n';
                    csv += 'Type,Employee,Count,Date\n';
                    transactions.forEach(txn => {
                        csv += `${txn.type},${txn.employeeName || txn.productName || 'N/A'},${txn.productCount},${new Date(txn.timestamp).toLocaleString()}\n`;
                    });
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'House_Stock.csv';
                    a.click();
                    URL.revokeObjectURL(url);
                };

                const totalStock = companyStock.length + allocations.length;
                const categoryBreakdown = {};
                [...companyStock, ...allocations].forEach(item => {
                    categoryBreakdown[item.category] = (categoryBreakdown[item.category] || 0) + 1;
                });

                return (
                    <div className="bg-white p-6 rounded-lg shadow">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">House Stock Overview</h2>
                            <button onClick={exportHouseStock} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                                Export Excel
                            </button>
                        </div>

                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <div className="bg-blue-100 p-4 rounded">
                                <p className="text-sm text-gray-600">Total Stock</p>
                                <p className="text-3xl font-bold text-blue-700">{totalStock}</p>
                            </div>
                            <div className="bg-green-100 p-4 rounded">
                                <p className="text-sm text-gray-600">Company Stock</p>
                                <p className="text-3xl font-bold text-green-700">{companyStock.length}</p>
                            </div>
                            <div className="bg-orange-100 p-4 rounded">
                                <p className="text-sm text-gray-600">Employee Stock</p>
                                <p className="text-3xl font-bold text-orange-700">{allocations.length}</p>
                            </div>
                        </div>

                        <div className="mb-6">
                            <h3 className="text-xl font-bold mb-3">Stock by Category</h3>
                            <div className="grid grid-cols-3 gap-4">
                                {Object.entries(categoryBreakdown).map(([cat, count]) => (
                                    <div key={cat} className="border p-3 rounded">
                                        <p className="font-semibold">{cat}</p>
                                        <p className="text-2xl">{count}</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div>
                            <h3 className="text-xl font-bold mb-3">Recent Transactions</h3>
                            <div className="max-h-96 overflow-y-auto">
                                <table className="w-full border-collapse">
                                    <thead className="sticky top-0 bg-gray-100">
                                        <tr>
                                            <th className="border p-2">Date</th>
                                            <th className="border p-2">Type</th>
                                            <th className="border p-2">Details</th>
                                            <th className="border p-2">Count</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {transactions.map(txn => (
                                            <tr key={txn.id}>
                                                <td className="border p-2 text-sm">{new Date(txn.timestamp).toLocaleString()}</td>
                                                <td className="border p-2">
                                                    <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                        txn.type === 'stock-added' ? 'bg-blue-200' :
                                                        txn.type === 'allocated' ? 'bg-green-200' : 'bg-orange-200'
                                                    }`}>{txn.type}</span>
                                                </td>
                                                <td className="border p-2">{txn.employeeName || txn.productName || 'N/A'}</td>
                                                <td className="border p-2 text-center">{txn.productCount}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                );
            };

            // Show login screen if not logged in
            if (!isLoggedIn) {
                return <LoginScreen />;
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-blue-600 text-white p-4 shadow-lg">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-bold">Inventory Management System</h1>
                                <p className="text-sm mt-1">Manage employees, stock, and allocations</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-right">
                                    <p className="font-semibold">{currentUser.username}</p>
                                    <p className="text-xs">
                                        <span className={`px-2 py-1 rounded ${currentUser.role === 'admin' ? 'bg-purple-500' : 'bg-blue-500'}`}>
                                            {currentUser.role === 'admin' ? 'üëë Admin' : 'üë§ User'}
                                        </span>
                                    </p>
                                </div>
                                <button 
                                    onClick={handleLogout}
                                    className="bg-red-500 hover:bg-red-600 px-4 py-2 rounded font-semibold"
                                >
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="flex">
                        <div className="w-64 bg-white shadow-lg min-h-screen p-4">
                            <nav className="space-y-2">
                                <button onClick={() => setActiveTab('dashboard')} className={`w-full text-left p-3 rounded ${activeTab === 'dashboard' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    üìä Dashboard
                                </button>
                                <button onClick={() => setActiveTab('employees')} className={`w-full text-left p-3 rounded ${activeTab === 'employees' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    üë• Employees
                                </button>
                                <button onClick={() => setActiveTab('add-stock')} className={`w-full text-left p-3 rounded ${activeTab === 'add-stock' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    üì¶ Add Stock
                                </button>
                                <button onClick={() => setActiveTab('allocate')} className={`w-full text-left p-3 rounded ${activeTab === 'allocate' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    ‚û°Ô∏è Allocate Stock
                                </button>
                                <button onClick={() => setActiveTab('return')} className={`w-full text-left p-3 rounded ${activeTab === 'return' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    ‚¨ÖÔ∏è Return Stock
                                </button>
                                <button onClick={() => setActiveTab('employee-stock')} className={`w-full text-left p-3 rounded ${activeTab === 'employee-stock' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    üìã Employee Stock
                                </button>
                                <button onClick={() => setActiveTab('house-stock')} className={`w-full text-left p-3 rounded ${activeTab === 'house-stock' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    üè† House Stock
                                </button>
                                <button onClick={() => setActiveTab('backup')} className={`w-full text-left p-3 rounded ${activeTab === 'backup' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'}`}>
                                    üîÑ Backup & Restore
                                </button>
                                {isAdmin() && (
                                    <button onClick={() => setActiveTab('users')} className={`w-full text-left p-3 rounded ${activeTab === 'users' ? 'bg-blue-100 text-blue-700 font-semibold' : 'hover:bg-gray-100'} border-t-2 border-gray-300 mt-2 pt-4`}>
                                        üîê User Management
                                    </button>
                                )}
                            </nav>
                        </div>

                        <div className="flex-1 p-6">
                            {activeTab === 'dashboard' && <Dashboard />}
                            {activeTab === 'employees' && <EmployeeRegistration />}
                            {activeTab === 'add-stock' && <AddStock />}
                            {activeTab === 'allocate' && <AllocateStock />}
                            {activeTab === 'return' && <ReturnStock />}
                            {activeTab === 'employee-stock' && <EmployeeStockView />}
                            {activeTab === 'house-stock' && <HouseStockView />}
                            {activeTab === 'backup' && <BackupSettings />}
                            {activeTab === 'users' && isAdmin() && <UserManagement />}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<InventoryApp />, document.getElementById('root'));
    </script>
</body>
</html>
